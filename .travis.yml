services:
- docker
before_install:
- echo $DOCKER_PASSWD | docker login -u karrot96 --password-stdin
- docker pull karrot96/todo-app
- docker build --tag karrot96/todo-app --cache-from karrot96/todo-app .
- docker push karrot96/todo-app
- docker build --target test --tag my-test-image --cache-from karrot96/todo-app .
script:
- docker run -e MONGO_URL -e APP_NAME my-test-image
after_success: 
- "./travis/build_and_tag_production.sh"
deploy:
  provider: script
  script: "./travis/deploy_to_azure.sh"
  on:
    branch: master
env:
  global:
  - secure: "ka+vJ+gVf9wWFRXrsGw1dOYGF6xGi63gxjkQ/fLWonr0pDwpVVJEzKDUZ0Xeal07wbK5fnEptxusrKXNUyJpPVXzOHfR7YHbhGkKdaQ3sZ+wKfVSP+HV34hWDM6IGz/YOEewyj+zodJ13UGxENGkk1Bidp+bviYX+kQClSFoSzh+tf1JzalnP12TqlEFdocJZ3ilj4TvMkVaX7Sn65PtLjInaGMxyiyNIp9SSnSejDS1A8I5tIwwodztILvgfmy4K8eJY2UzTr6mnuhV+cKvVTH0jsnVhGRkH02gowBUlKIZ9Zn9B0U+OXcSmWS8VeIMGZ7sL+hOp1fOpQwTVDSIc9cnWsKO3kskinUEJnBez4zn0lY4OfQ7f/iZ3Lf8cyy4emPhxnNCkiuvBqagKFIS5q1saXEQIKuLIBc72iIYnKTHz66CqGoYZy0jRGuF8NR9Wa8Toz6+DtLWdb3sUUj6txZE38tJn05tnSu0LpZLgBmB3XNR1eRKdL0xCJqW1aV2VwpAw98gy4Req4y16NhUwVWSJw2LzsuSLEm8/08375mUmtheY2kj3YBXWFqJT5p4O7Fv7RRy/BAA+aeo4D7k/4zuViApud6Ny5uhBn6iqXaPBgIcIVP7LPAWA0MP9qyg1/NUQ6jNRk9kZ39Xa9ol9jRHMhzuJ1g9CSNw/BZGfuU="
  - secure: "wm3fzdS/qmcRc4ylLatJI6Hh3BMTxxo51zbvKyim5b/ao5L9W6BiR80z0vkMyqGf5LFxUJk+2p2Fp+t0ENGFVDevboaYKdzlNGTKXXP7GCuyswVhMYAJ+8zQ3uGI9yN+7iDCUVR2yfu10go0KXqFn2aU2FO2P/zt9VxiCA8R/jvQF/ma3iUr14o1X5RdezbgszYVXzKKY4dWcKgxD88wr8tqJzwp79KGytuMHTtz5vWkw5bvTuAoxpZCXSkwI3FNWFX5ctcz0OZHfYMR5xM9/YMvG7OF9Vqd1ejYhwbuiBofSwskzAifpArQw++RX09bEjxR5l8/8TMvLvePy4EbglqdwpE3+A1qxPo3Vmda8hFYauMDbObx+wyFDtt5qsoXDTUds90IaWbAqhBjcPlNc1vObiQIUQUAa3JAc1DujkEFgboRIwKeBqQPcK0XyPt3ocl4Kq7AinXIY6gZEhTnsumKCTFpQikes0PaFp2wgnDeRYAyHNmAnweHiPqKnc/+vMU+R0XOpilPs87ynoeCcjpmAC50foKxCGI2E8ZqGnT/ScdToVORVOTFZanF3Y+trWt65ppeb6B6FN7SmQat0hcI3kkH4asm65QCZbfko4AmtTIXzh2EJshIbXsi8F1IaMLOLDyZ5rrefBWkR4OD0GuN1wHlAMXUlZfxH7CPIqE="
  - secure: "J/HWucEg8YcC3IzqcIVePXtAFGzY/pqoUUDqUrmnQdtNtd5GogBzvjoncNtw64ETq6HPWj+dZVRk3KfTvSPQURn25qbUg7mjFZ9VgoDLR494d0F1HrK2vkX70dfVzHfIgvVLdxhIjWyq5T1XfHQmthG38UVrBObUkhRdvk/55MXLxZY29+tv5Z0DBsTBAaADd6WMYI8oLk+GbJi3rqIWIv3aDLfOzvT+cMzs+pDUTID6rRyj897wK8G87Zqh6U4hsSE7ULJvqErT5hPOH8AsUPBgjGC0x3NQzTfEUhfiUwoDCjPD0YpZF6TYhdsrmaEukPgZ4IoqZUIavZZ4b4xtj7TffC4ZAR4BaNkf/vcktBxFVvbbgF9Rc56h6LRriUNu6Y5TO3fcTiKxFdKrB2j5k2LQGFBLrpetuJExLcQFHFqd420gKfIEMTNNEbMuLPAjZye/QB7+S0zE9PWCLlJ8bTcedeN49gWinNlFVysyCuiDJJ1pcBq3/PEv2y9vjZg945dJkT+3DafHkQV1GxLIjNKZI7lXikqPAm8hy0ZaeAiGsGdAjQzCVy/S6hu8qtHe/8mFVwzhyDEY6YGcATmVtdypoqmUSuZQRM/KfCn+wuDvOlPSJW/GHDelpEQeLXbv/ZMB0lMKJUtuJG6tXwC2tg5DcsJJq/ttU60LvSgsRo0="
  - secure: "Ljxedw0vc57IUD9SicDrmUnJKQa6+mCqo4Ou94ATQlWOuSUAH4ljuuC9XVyHMrKycj/d0y4PVq1xkjz56fZTIqJBmaKWbXjKouYyHtafW3UzzvstCSfPkhbAmWaTBk+XhGmnWQToH56Z0WDZgQJV98rWPPcxjVPtd5sOsXfYV63vBYhU2KSNOTsZjxSbvVzM8aWEMjDPKwnVApy/Rb2mrpbcYBhZGOORK3aDbTJ9Dym89x6KlkukP+s8b+P7T6wp4HnN6c4RgP/T/a9pAyIXVbplXpuiruv73tgot32Cv3SMdRbV4TldM/z5QCWsckGBMFj8fwO0s0vE6InnuYbJeUeMjOlPxhtRnZcfM/LCl33l7NWMzRYD5vtBp8SJwwki9we34AhgnSx/q1Io806j/nZGbA5oeIQr02JtCYhTHU98E/ySWyXL2ii6iSdtHKcDHZ7VUp6PqnCSClz5J3jDUog0VI78PnGtaDCLqMv4kkMPreA6+FlCCqizdDbOa+jRuVKlKk1RHhMQMcl8PnG3MZ4PaX9pIQgqYAvg1khz7ufXI8eCMYRySufhEy28hzAIqqbzoRBnuRjsMYxxzFCOHB2GhjBNaHCBv1d7mB9Ngluy52T6Gv3EkvYEp0PyBklHR8FtXi+7VifP/YmI8enr+aUblJt69ZnMuHEoAES1SwE="
  - secure: "Kawe86Sl6BDewNWWWjzT5eIEhte1VpCV5DEtlzcVqag+GsdpA26+R3XsrlTtZPx4N+17kjofGGDKMdt9MGO/p3tFl6SXjNWb9hUXpBIInP4AHZgRB4peL2rmENYXa0w5sPJC9D3G1xGf0Htp+9vrAZm6cTWOO1kruNmq3fCzWMYaMjPyVvF2KnXHKKnNmnEGUNTxqVUwdZwyAblG/bZ6IqFFwgLxnNbDfHaXrBX7A/9NX9jSEj0SrV3bHJqow1wfj74oYPheN+mSHLRWWwqNVsRkuWMRpwT3YKmPNjQoyE42JLUQEih4JJVQOEZqnD2o19reyr1+5+PEi91kC5Ylav+4L5/qB27HfI4JaTvVI1IaY4TMLubdFcxd1zcFzDjf/kl7d3y8unJU+9Y4zJTRM+U5EcLIzwOxBlJTkv3CYDMxfEMH1JNMOKsXdjAXTdW4YJ/c4kmPqslku1RfHyH91Qq6gc0w8eLRWNDV8LkZQ+J+DGKdi5fncrOkq7YfaTAyyef/06A/+bQAv57u/k0VB2eyntpQQ6n9Zd5XiYOlN5OAsJPr0QyzGxw6H6YoBJuXh25Fx+QXN2+9EezQ/LmFYDwCnnmv51lgCaMl2NePnvEFQ7xu0Aph6blaD87xh1mDL7dKvMM2abaY1Unkep00AfVi6QpThsDUxRcgoXfsWNM="
