services:
- docker
before_install:
- echo $DOCKER_PASSWD | docker login -u karrot96 --password-stdin
- docker pull karrot96/todo-app
- docker build --tag karrot96/todo-app --cache-from karrot96/todo-app .
- docker push karrot96/todo-app
- docker build --target test --tag my-test-image --cache-from karrot96/todo-app .
script:
- docker run -e USERNAME -e PASSWORD -e MONGO_URL -e DEFAULT_DATABASE my-test-image
after_success: 
- "./travis/build_and_tag_production.sh"
deploy:
  provider: script
  script: "./travis/deploy_to_heroku.sh"
  on:
    branch: master
env:
  global:
  - secure: ka+vJ+gVf9wWFRXrsGw1dOYGF6xGi63gxjkQ/fLWonr0pDwpVVJEzKDUZ0Xeal07wbK5fnEptxusrKXNUyJpPVXzOHfR7YHbhGkKdaQ3sZ+wKfVSP+HV34hWDM6IGz/YOEewyj+zodJ13UGxENGkk1Bidp+bviYX+kQClSFoSzh+tf1JzalnP12TqlEFdocJZ3ilj4TvMkVaX7Sn65PtLjInaGMxyiyNIp9SSnSejDS1A8I5tIwwodztILvgfmy4K8eJY2UzTr6mnuhV+cKvVTH0jsnVhGRkH02gowBUlKIZ9Zn9B0U+OXcSmWS8VeIMGZ7sL+hOp1fOpQwTVDSIc9cnWsKO3kskinUEJnBez4zn0lY4OfQ7f/iZ3Lf8cyy4emPhxnNCkiuvBqagKFIS5q1saXEQIKuLIBc72iIYnKTHz66CqGoYZy0jRGuF8NR9Wa8Toz6+DtLWdb3sUUj6txZE38tJn05tnSu0LpZLgBmB3XNR1eRKdL0xCJqW1aV2VwpAw98gy4Req4y16NhUwVWSJw2LzsuSLEm8/08375mUmtheY2kj3YBXWFqJT5p4O7Fv7RRy/BAA+aeo4D7k/4zuViApud6Ny5uhBn6iqXaPBgIcIVP7LPAWA0MP9qyg1/NUQ6jNRk9kZ39Xa9ol9jRHMhzuJ1g9CSNw/BZGfuU=
  - secure: wm3fzdS/qmcRc4ylLatJI6Hh3BMTxxo51zbvKyim5b/ao5L9W6BiR80z0vkMyqGf5LFxUJk+2p2Fp+t0ENGFVDevboaYKdzlNGTKXXP7GCuyswVhMYAJ+8zQ3uGI9yN+7iDCUVR2yfu10go0KXqFn2aU2FO2P/zt9VxiCA8R/jvQF/ma3iUr14o1X5RdezbgszYVXzKKY4dWcKgxD88wr8tqJzwp79KGytuMHTtz5vWkw5bvTuAoxpZCXSkwI3FNWFX5ctcz0OZHfYMR5xM9/YMvG7OF9Vqd1ejYhwbuiBofSwskzAifpArQw++RX09bEjxR5l8/8TMvLvePy4EbglqdwpE3+A1qxPo3Vmda8hFYauMDbObx+wyFDtt5qsoXDTUds90IaWbAqhBjcPlNc1vObiQIUQUAa3JAc1DujkEFgboRIwKeBqQPcK0XyPt3ocl4Kq7AinXIY6gZEhTnsumKCTFpQikes0PaFp2wgnDeRYAyHNmAnweHiPqKnc/+vMU+R0XOpilPs87ynoeCcjpmAC50foKxCGI2E8ZqGnT/ScdToVORVOTFZanF3Y+trWt65ppeb6B6FN7SmQat0hcI3kkH4asm65QCZbfko4AmtTIXzh2EJshIbXsi8F1IaMLOLDyZ5rrefBWkR4OD0GuN1wHlAMXUlZfxH7CPIqE=
  - secure: "ANV0LtUrMrSBeSK4dWGbc/Ayoe6XCmlmNJ2zVfh1kdbhEhj+XUDiN9x14xLHPXtWbQS6wfL90cQG1t6zDkRZCFcS8i3ilNqXzf40JR1jlli3ri6DVeeepuTirfxu8vvfs0/F5jIGHVbjYJWjof1L1eIXw33DuKG9nlUzwumbECchPNDD/t0dEUQzKnH0Cx1YNMmecmbpYGJhMo+RKH0TvcTUWm8YHrSDBfESKIHE0Q9NRL7wlzf+m/8dD9MZYIGFIm33V68MQ5cDi9OY5/+RllaPD9PCWlPWpRcC7kh96lb5/rDkCJYfMO6o/Aw/OycVoKhNQUPwOsdolhqsVY1AItDMCHX9Zr4fWmc6p+7F5Ct+DXEdhKLZm1ZT153zhfyLB/a4ZROuR3QMxzOPDK8PyTVB2rbJ91QCDpSws++b++wmWGCArdl+fdr9OR9Jytwy+dllSvAs3u/CudQdJz1kKP8MUMQjKPioz2mlkvckTAAjTrisDLAW9fGagwlGdB/ONDXCNljMMvv3/WxlMjQ9R3TW7BJo2vLqWRWT0fDr21nSVzB+b8B9iUyiSVWBAXUu5fk8Jido8+mk4h6JlTihG4X4jTB1rNjklOfAdLYWX9UxNzpinpZQE3c43gcfNHnbTN2VCVAiagJQGSToQKMqY79szROGSeBB/Fl1XOE4au4="
  - secure: "kqIQdl7ue8PT+lHP6dJxBduwQIPGVDLAfpc6gpOZ8sNPY075ENZl8Z9LtQytmZgJA/FZQSWaGUE+Pn+e1ZYwy6vN+qYiGnTxDKYK1nfMrocOQO83dRKsZAKAJfruJz+hTCp/uyrjGWEjxgaD9FXlIC1isKtBA1jkgLL+WhG0hyHGtgqkig4RK3UeuJVUju4noexW7z7nM+DT8N8aHpcYYVJNUPaD+uqYA3f4ilOr426U/kIz+F+uuq3yzxArFMdynW6fgZ76mOACDG4tOFm0rXSvZ1V4mulJkGOUhEQ7dmH8u1ubzwxMuM1HetVE5JDQkqR0yRuFyxN+57liX8WMpkD0ZQk7Rm1v60X23wl5xSnlledw7nHM2sXpfiSLVZHk1Xvu+lAHABdSs4Q4ZZHfvzNQ+2fubvHNhFj5YTJlI+j5Tw6oK5ScCiiQtZMdxXbY9nTu+B5HU6tB29BhgOZnOWDGdnYgYQaJDT6E4YZc7ESXLLFlcDaKcuJz05sAiHIw3psAsuqiTSKSbcyRYTfWBnawGr8mvzE1YvMxN100d9zP8ryjLOdcfx13h9IOWQf7NHNTe19O62MDv8mCnUq74J/OlWHGtnqkii1IBApJFfBeqbOANuno4JbWO0KWR2Ax5ecAjHo8IkJk2uF/fc692bz5tFJcDKOxyeYZn4fcFJ8="
  - secure: "tJHhgNMYjRgq/qTP1FR7dmRYYxH/6WCtjA542difQsixO1vHdVcjbWyhfifZYfH6KfbD3kARkrQcv9eFGi8JxlsvAv5+kLbwYV3fWs1cBIP9azu5ncUK9YAjdhnKQGpqDcFP/jMZJ1A7aDB75+ZZFIqv+DL6mvpXgp4Ov+smizI55eDzzvrVhQyXd0e8Cit6+ZyUxg7v0Z9M6AFaLfF3YNZ4RtZJuxyEbXea/gU8CqjHA+JCdlu8mri9D6XyJaI7npQGW6DvhYJ1HjV7dcpcaGe9KGByfBgYZ4wrBk3l+kr6LHnH57Aev6mPSvZ4O+u5PR8ImpzrdecNyaUBhGj9BqktIZAEXezqCF8NUE8sZ0+9XM0wIRQps0aiv9G/oLmaGIJwNaOZz/O9/Ei7RtrdFJWo+z5xWtV8umk2s1DYMNfcnd440I41X2jAdjQSHpy9RIOUVt1TXktbmomm11UIDVhgVkZ5x6NWJyJnvZvidC33W49BTP/td50EoLn8bCwelgi9dQy+PORZzoPxsqDz5im8w/1i/3SGAIyJD8ujirH7xsREBQ+F9H8YORopBYb6LpcjvMnVfzjPzDfnUBggbIcl4hJIyUZpvPomCTXr3gW2idnqgoNr7HjlVw5WW+GL9sU3SfSg+NcLXpsTzsULmrX7yFcz1ZnGc+APNe8kAGY="
  - secure: "iSmRSSlj/ao57rpaed1n2KLPKKhT/C7iA873iEPLj2p9G3ibzZeXE3Ey2KmCih2PxcFqBTrMqD0FNLMrX3Sood2OAyTmH5C76ix/UFv3FKOCW3f33KINLZMg5VZyP2kExcwHtcs8oF+fUe0O8mUBc6DZ1PFLwjvbWns2Zxo5S3gg76h2AiSZorq/GoWQDtw0HjtBMOQoQMlf4ZH1UTBd2xIn894uysIlXzLIBqxkeET9B33OfdL9lvQWOL1NDl4wVJF4bTQK+ThOTNu9AymNJxAMmUBlEKl/PLzfc8oc5eyXjV4fflJdDPEO5BfIsq7NPdGFql1dzfSoPDT0gJu0RGr7i934GTWP6L/FQnHX+zqsFJGOS9P771QSM8aUv/cEbW1pkVBJk9BLJ/iFbIe0YSf3pNlgN3RsDjyTDXiIB/TNnhEn6RmLDfrOGTtYDb6qIwnMV00dJRaJ+rnstwblY8ZXIqGVoiW5KYqhTZVeQsthYEwnpIb0/9NqFhn/sb2kruwMPnoQ9hIltFYJKKMCSSdVBqd/d8JIpV5XFmybcWnBzsqSpOa19vt2x39TKBB90m5j28nXMH2QBzjEkf5ev0imgoymCE8IHeikXHV03R2xrZRjghwj2kTGzbzVxbkNfkg5BKTy3EgyuY9PpLY9fMGKrjywFKIfU078RN3QCVs="
