services:
- docker
before_install:
- export TF_VERSION=0.14.7
- echo $DOCKER_PASSWD | docker login -u karrot96 --password-stdin
- docker pull karrot96/todo-app
- docker build --tag karrot96/todo-app --cache-from karrot96/todo-app .
- docker push karrot96/todo-app
- docker build --target test --tag my-test-image --cache-from karrot96/todo-app .
- docker build --target e2e_tests --tag e2e-test-image --cache-from karrot96/todo-app .
script:
- docker run -e MONGO_URL -e APP_NAME my-test-image
- docker run -e MONGO_URL -e APP_NAME e2e-test-image
after_success: 
- "./travis/build_and_tag_production.sh"
before_deploy: 
  - wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip 
  - unzip terraform_"$TF_VERSION"_linux_amd64.zip 
  - sudo mv terraform /usr/local/bin/ 
  - rm terraform_"$TF_VERSION"_linux_amd64.zip 
  - cd ./infrastructure
  - terraform init 
  - terraform apply -var client_id=$CLIENT_ID -var client_secret=$CLIENT_SECRET -var secret_key=$SECRET_KEY -var writer_id=$WRITER_ID -var loggly_token=$LOGGLY_TOKEN -auto-approve 
  - cd ..
deploy:
  provider: script
  script: "./travis/deploy_to_azure.sh"
  on:
    branch: master
env:
  global:
  - secure: "ka+vJ+gVf9wWFRXrsGw1dOYGF6xGi63gxjkQ/fLWonr0pDwpVVJEzKDUZ0Xeal07wbK5fnEptxusrKXNUyJpPVXzOHfR7YHbhGkKdaQ3sZ+wKfVSP+HV34hWDM6IGz/YOEewyj+zodJ13UGxENGkk1Bidp+bviYX+kQClSFoSzh+tf1JzalnP12TqlEFdocJZ3ilj4TvMkVaX7Sn65PtLjInaGMxyiyNIp9SSnSejDS1A8I5tIwwodztILvgfmy4K8eJY2UzTr6mnuhV+cKvVTH0jsnVhGRkH02gowBUlKIZ9Zn9B0U+OXcSmWS8VeIMGZ7sL+hOp1fOpQwTVDSIc9cnWsKO3kskinUEJnBez4zn0lY4OfQ7f/iZ3Lf8cyy4emPhxnNCkiuvBqagKFIS5q1saXEQIKuLIBc72iIYnKTHz66CqGoYZy0jRGuF8NR9Wa8Toz6+DtLWdb3sUUj6txZE38tJn05tnSu0LpZLgBmB3XNR1eRKdL0xCJqW1aV2VwpAw98gy4Req4y16NhUwVWSJw2LzsuSLEm8/08375mUmtheY2kj3YBXWFqJT5p4O7Fv7RRy/BAA+aeo4D7k/4zuViApud6Ny5uhBn6iqXaPBgIcIVP7LPAWA0MP9qyg1/NUQ6jNRk9kZ39Xa9ol9jRHMhzuJ1g9CSNw/BZGfuU="
  - secure: "wm3fzdS/qmcRc4ylLatJI6Hh3BMTxxo51zbvKyim5b/ao5L9W6BiR80z0vkMyqGf5LFxUJk+2p2Fp+t0ENGFVDevboaYKdzlNGTKXXP7GCuyswVhMYAJ+8zQ3uGI9yN+7iDCUVR2yfu10go0KXqFn2aU2FO2P/zt9VxiCA8R/jvQF/ma3iUr14o1X5RdezbgszYVXzKKY4dWcKgxD88wr8tqJzwp79KGytuMHTtz5vWkw5bvTuAoxpZCXSkwI3FNWFX5ctcz0OZHfYMR5xM9/YMvG7OF9Vqd1ejYhwbuiBofSwskzAifpArQw++RX09bEjxR5l8/8TMvLvePy4EbglqdwpE3+A1qxPo3Vmda8hFYauMDbObx+wyFDtt5qsoXDTUds90IaWbAqhBjcPlNc1vObiQIUQUAa3JAc1DujkEFgboRIwKeBqQPcK0XyPt3ocl4Kq7AinXIY6gZEhTnsumKCTFpQikes0PaFp2wgnDeRYAyHNmAnweHiPqKnc/+vMU+R0XOpilPs87ynoeCcjpmAC50foKxCGI2E8ZqGnT/ScdToVORVOTFZanF3Y+trWt65ppeb6B6FN7SmQat0hcI3kkH4asm65QCZbfko4AmtTIXzh2EJshIbXsi8F1IaMLOLDyZ5rrefBWkR4OD0GuN1wHlAMXUlZfxH7CPIqE="
  - secure: "J/HWucEg8YcC3IzqcIVePXtAFGzY/pqoUUDqUrmnQdtNtd5GogBzvjoncNtw64ETq6HPWj+dZVRk3KfTvSPQURn25qbUg7mjFZ9VgoDLR494d0F1HrK2vkX70dfVzHfIgvVLdxhIjWyq5T1XfHQmthG38UVrBObUkhRdvk/55MXLxZY29+tv5Z0DBsTBAaADd6WMYI8oLk+GbJi3rqIWIv3aDLfOzvT+cMzs+pDUTID6rRyj897wK8G87Zqh6U4hsSE7ULJvqErT5hPOH8AsUPBgjGC0x3NQzTfEUhfiUwoDCjPD0YpZF6TYhdsrmaEukPgZ4IoqZUIavZZ4b4xtj7TffC4ZAR4BaNkf/vcktBxFVvbbgF9Rc56h6LRriUNu6Y5TO3fcTiKxFdKrB2j5k2LQGFBLrpetuJExLcQFHFqd420gKfIEMTNNEbMuLPAjZye/QB7+S0zE9PWCLlJ8bTcedeN49gWinNlFVysyCuiDJJ1pcBq3/PEv2y9vjZg945dJkT+3DafHkQV1GxLIjNKZI7lXikqPAm8hy0ZaeAiGsGdAjQzCVy/S6hu8qtHe/8mFVwzhyDEY6YGcATmVtdypoqmUSuZQRM/KfCn+wuDvOlPSJW/GHDelpEQeLXbv/ZMB0lMKJUtuJG6tXwC2tg5DcsJJq/ttU60LvSgsRo0="
  - secure: "Ljxedw0vc57IUD9SicDrmUnJKQa6+mCqo4Ou94ATQlWOuSUAH4ljuuC9XVyHMrKycj/d0y4PVq1xkjz56fZTIqJBmaKWbXjKouYyHtafW3UzzvstCSfPkhbAmWaTBk+XhGmnWQToH56Z0WDZgQJV98rWPPcxjVPtd5sOsXfYV63vBYhU2KSNOTsZjxSbvVzM8aWEMjDPKwnVApy/Rb2mrpbcYBhZGOORK3aDbTJ9Dym89x6KlkukP+s8b+P7T6wp4HnN6c4RgP/T/a9pAyIXVbplXpuiruv73tgot32Cv3SMdRbV4TldM/z5QCWsckGBMFj8fwO0s0vE6InnuYbJeUeMjOlPxhtRnZcfM/LCl33l7NWMzRYD5vtBp8SJwwki9we34AhgnSx/q1Io806j/nZGbA5oeIQr02JtCYhTHU98E/ySWyXL2ii6iSdtHKcDHZ7VUp6PqnCSClz5J3jDUog0VI78PnGtaDCLqMv4kkMPreA6+FlCCqizdDbOa+jRuVKlKk1RHhMQMcl8PnG3MZ4PaX9pIQgqYAvg1khz7ufXI8eCMYRySufhEy28hzAIqqbzoRBnuRjsMYxxzFCOHB2GhjBNaHCBv1d7mB9Ngluy52T6Gv3EkvYEp0PyBklHR8FtXi+7VifP/YmI8enr+aUblJt69ZnMuHEoAES1SwE="
  - secure: "Kawe86Sl6BDewNWWWjzT5eIEhte1VpCV5DEtlzcVqag+GsdpA26+R3XsrlTtZPx4N+17kjofGGDKMdt9MGO/p3tFl6SXjNWb9hUXpBIInP4AHZgRB4peL2rmENYXa0w5sPJC9D3G1xGf0Htp+9vrAZm6cTWOO1kruNmq3fCzWMYaMjPyVvF2KnXHKKnNmnEGUNTxqVUwdZwyAblG/bZ6IqFFwgLxnNbDfHaXrBX7A/9NX9jSEj0SrV3bHJqow1wfj74oYPheN+mSHLRWWwqNVsRkuWMRpwT3YKmPNjQoyE42JLUQEih4JJVQOEZqnD2o19reyr1+5+PEi91kC5Ylav+4L5/qB27HfI4JaTvVI1IaY4TMLubdFcxd1zcFzDjf/kl7d3y8unJU+9Y4zJTRM+U5EcLIzwOxBlJTkv3CYDMxfEMH1JNMOKsXdjAXTdW4YJ/c4kmPqslku1RfHyH91Qq6gc0w8eLRWNDV8LkZQ+J+DGKdi5fncrOkq7YfaTAyyef/06A/+bQAv57u/k0VB2eyntpQQ6n9Zd5XiYOlN5OAsJPr0QyzGxw6H6YoBJuXh25Fx+QXN2+9EezQ/LmFYDwCnnmv51lgCaMl2NePnvEFQ7xu0Aph6blaD87xh1mDL7dKvMM2abaY1Unkep00AfVi6QpThsDUxRcgoXfsWNM="
  - secure: "tDZ87osxn/lhzFLJAYNvrj/e2B6QAMrberhtI/IEBalY4Pr/U/Z1VBwpoKmy/2dKyoNwlw9Ba8ptfhKGsfBlSSKJExgtUj0giAp1wLzX1w1iSuy9HHcOSvRe0c485f8WCTPXbRhHjX8t2rkmRmAAaJ3ix1SQbWezXCcOydhxhIQ+gFTuWnigCRjgrD18H1IFsx90vm5bt2vWmywkHukqjPqe4LhnzTdp3l9MAmKYgk7DZhxSb725AvHcc2BiZjLh5DURb2p3vyHF55DnhaiuhHYczjjv6jBcRkKf4i9evIFX8784gQ7l9k41kUpTJ1FX7kdW04mAh2gnxcZvhMMBpjhJCCl/QCWIMo4PcIu4jpr8DFRbjbDiRfOM4RaE3xqwmuNuQxoBf37rz+c+SyU6qUVJAf3XEjgQvUuj4reGXILKwXYHpmChG32qt1MmLr7fXGwWr1uyOumyDfYnpwZZrB3wmFF7h3TAJS8WclzOIO/vp02E7swz2kmzIZC+HUZBUtKQufRPHyeQEsPZzx3a5FuGqHiC2GGswpnnJIslFRIQP+uchYMuMIEF7JN5L8dRSg53BLcMrYClSIofvAdqXK7kMsnbmydctYVrXXl2gipBeybOi8pQ5fxwhKNoTC7YCbS89j4OQOxs6RnjqWtIl78w8g4upKmfCPn12Rq2Co0="
  - secure: "ZcKfQFz65nBlQhW+uFVD6E2W5EkMdIVU7F81EFkCuS9bOD87W7rxHMqTlzGPDBRo5eAjy7mna/1YynQCzaHtsGE58pd6WcnMEiT7tMR/32CbbHmUXRdRjFFBlULrz24mRE367DcebieyiBnb0VYrglUn+R/yuZfH1geLHYb+DMRA4qIlStp3+93NVdRuE44KTIBYIqlYpHWik16HNgQ5Q8sKeSQ3vbmH644ELdzQNwzhC1hRY/S5CZgh4Nw2F+H9ZO4s4NBNbhhC7QGfXYqRr55QUxbZF2yM+Ip/2tG9VQ5UPUu/htZ7n3oxB/iL2/RPSJ+9B5ABYqyTpNHa3Ab9j1GVt590klna9QJ7V5mpV7w9HxwOvciOpb89N8Zx9gEqzVhb1g4AHxQVoOFVGYWd0dqlGNKSgUPuHFHI9nLBIH5EGgQ00lq2Ns6BvrGTGm3qbFpRfphZ/suFv9qo9RU6wQi5yj9EJJo+L+CwiRHWwIXfNOeMLuggTxnvaaOOmbfNdobVBKBSBR3kKzPmJEeTwGQhg8JjQXSdtTilKJNmVVOb6kkEjj0aqkoEgiAOyz5NsHKNVlykR+gKXOE77OhRmhsW5ZUYzER+5qkE0COk/TYzpBpSGGV4DATt0VStYbQoyKAhb0dSxQkBg6R6zf7k/pYrtc5JUSi7/Tkod/sqFI8="
  - secure: "OP/GtdpdwgvNIYZItdEjbGI4jn3+TjUPvHV4t9/zsH+NH7qdnYtGD6CxzMeUuMVX1AhAf4sXZCGvQuusd0za0pNK8V9X4vGHm+3fBPaDwOP5WFY+PZO18PITG8th96V7czN97Y6aqWzzEhX37ADnsgdgB3TojHDpvPN5XTwhKj/n1ioO8OPExCJfghB2teanL6k0kpAEeERhP9CcjqoXFx3juyGQgs1hi3c0BJsGNsqsUz3fMOYGN4j6X3f4QIGxKB1M9OEZaOsgO40Q1mpyp/p3H/WFba4I4sljLSW34i8wdll78YmoMv6E2AwB9IN2GFHhbGAmG6vA8UQEYGGmKzaXof6H8GgPdo8wvcwFTpb1U8ajTFq1FL9uPXbPKHgWoEePWs5B0LPxwI6+KQ5emcrrtPNcyXixCQam79lPyUYwL9+jiNGLR7y3Ltvce+xxR/UFPCI0b4rYSMcZvVmpHXmS/gWRwvUYBd23pxMa+VBIUscXDg+hhaVWHF3TvtwfrddCvKjP4O58KHnziZwy9ceCWMXfUyG0LYLtVqOWDmIpPVJrlVh6Gvc38A5v/s5XCzY8FQwJ+stmsWmjBvn4cWyJCa5JuBNO8L9/4oAcv9IfCQhK6m+9fAHvGHUgC6ehYYcuTwZeERL+pKZzK+qossDH/j+QD8H+XZUOVO/T29I="
  - secure: "PeSW+5rwrhaHuofS2XeBYhJpbL4rPOCx0IYj14IAWUyFLtbc7VX5JHd3XkEtjgMeKY5zU2pcGAEXDnmUNIpLTrE8CO58G5L+EN3RvsxNMoM6beRrj2PjW3cGaefnxhobDmKNjcZTfhjTxAH4naYZdmFDqCRo7zxpW/jrDpirQ2Qyv/zJ8GHp8LaPFAKLoZCIJRE+S4RebLnDwMU2IbNZT4h2Zf5bb+YqoHIiKvLgGWuXZbQF6bxn44sc5s2YPdYtb8hLyKPr/4OeM+TctRb7jGht5L4HBJ+tAI6zWtwWrHEYUgbQMx4oi8BABI7VJwqs6WhlWqDpLzRPly18rFH40tuWOVTwIuR8sQDNubWvc3NnoWJKu8m3TppUVS0OMzj7oSjk9MTo0abhB0ddA8HyaDGTb3Bqh/L1WGTP4NgtOxWZMtpzRMDV9Fxd0el789BkbLcmxXOBzV/Zf5puztAfBBYAu+fVX2ViPRRZpQ42vKcS0npmwXdKsr/gizbjhzzUZsuuvguSOLId7c7QVeLGTBBLeoHmHE+oScEQRts76OA8sYSY+UpfxVraA0ZOP0FeRGAnGLWMaVz0SIQ3AKsX9FGGra8LnIOTJ/mHElRsIrRL6Y+Rmx2Z9K7+O+OVI2JfwXTHzbBF5xLGCeP5qj8N76yQ1hivkcAVUyJTMa0Ubhg="
  - secure: "MM+Bhzo/SxWwwh0KfTCFSGHinyCTmDRGusf3tTnxKSfj/qoTNie5hJ6rcSXjk4bL1bJa9ZIjAUgi1C+BeArgxXvjnsVgrNyZb2FEJoHUKbQPQzu2hnaumJFCw8d23Nb1WSemNm2GN7ecV21smAR2qQz4vTm1pSFsR2fqRIruDuD4n9H3ukLkZnb3R5gg0sjIZyUxmlxe5D4R1ujhfi1JbMN1Axduy4btOISIVnZgX6KV1+iDjbV+VOgq4dj6Z284oMkJcfG6C2AI8Bv5TwAY4fNOmSKwuKCG/KLcipkFnXImZHDn56QTFLHWyZBSr6UFsNnEMDNaD6XBts6Sje7E6YxdIARLqpS0gj4iM5D2hYQklBJ8gO3vJDjHo+q96dJxfuuCKwBd2X4SXaZGlJ1VAd9xKRkiagJg8VFAJxbhuu+2tSy/U8gvZftgP/iC2IGB5h8PR+5+pTnhlf0dAWRucwsxQZ624Ag3AGcxsxYR1jJX8SMkAzbS+zLjZcLhoDTDYM5w81/IEyrBeMibzr9Mp4yHQnJd+3wObwFHu655Mu/iqK4wKIfurtt1iLlFJt7isLQOsYvrpJQfitpwfbJbU/5FMmhizGN71pUMQyqvdTVSnagaErCQuz5l7CvwQ7+JEehHBhOq+axienOJy1QiUBAkgd+tr20X0H2khtz4134="
  - secure: "gcQRNT0MsN/GRF71rmO6ElUu2w8ZV3erHC0G982vSiT6bQqN4f3H80D+lHH5NkCqjMKjTNksjl06g8ZzlxZUSslAh7QuVqwp7oTTnrddG3wmWGmfXBnw55Zsfs1uLdlWvhRWr4tCJ04HkojL+J5XV9T1T7U97VB7EONcYVtDogLO4lE7UUVenT963ULp8B9jJkpSqPDow7oxb//b4rElPf99zA5cfzgWGDfUHkkVTc5B20SyPgbuQ181t0MIj9zaBAkaYVWk/2nkNIC7Yf/rlhN6lpRqE9/eB7+jl2J7Kn46KqioaS/i8FOZz7iMDFTx2Pl+Pz40i0MYgc+nGFN3JhRtEGcaLCgrEoSc5mhsKCIZpEWm02oLsBZ+zSCuVkgPBMB2m/ciWppqkPdjLD8Dz890H1OVvIu912BAVknvcJPCF8XtKoV/fkxJ3eOGKMy9medbo7up141HtkPIwKkLmi3B5U5TSpSExUPSBf3v/1Hu/6XdtZxps5YmOxn7T8HzC0fompjK2GJ0YUI7ZcEd8+EPi4+AogZ3OFVtJ68q5kqXnbs08VIBhhrGZUCM3kWFKyIyrESI1QjWk2l/WWBxyMxMynP2d1wH8dedsr9BYePBU8AdmWYLLrW/DeH7rkHUzIit+OjL1M70TsvKV0rym1iuTuA6+DZfn8FUvNwxyZI="
  - secure: "Gw781tVA6gPXVyho7bNCdAe/knVBUdwl8DTcpYIpRnXfKhccIu19N7v7diA6LtZtbb1qxyDGREshF8OBHwriHm+raGIwWkVwVoAuotAHoxe4jC5VRy+QbWznUPOOtdSYTpoBVkPrHJcNTdA2GjKnjwNgsEbCUDSpneeI8vvPCT248sRLH6ncev0sk3yhhk1dH6mpiwfxS5mCeF3LeQ3fUMsnrEu6IN9oAE1nuOgu17igSFajZ7/oJTLPajFjCUY868Ro0rink94yVGUoGRfxCwipLiI0ihBaekFhXF3zQh8D4IAJWZOt/rKT7f1hGecDTbqMwS/WTFoirVU20CxKJ7b5V6JLtmD8QTTjohzUhYEnAdyaZBCDFEfKPZi88XO9XvDxufaFEccXtOzE6egEbmaVlJSFFqbuS6/GTGty7q/mu1L0ZKSlCxHy6UB5xRHbFjzJmQXahYiYI78weXOzxNkoqc4LomlOK4unV7LIvzBPyr71L+1IkKR09mS7FHV9tXkqOz2+j6+b8AEXs7zb1IKxfciYWDVNSKJ7ABA9kTXokC1MoLIHRmyNNefHtbCCPfSKHE3qDF4T0fJgX2KRc/wrYf4y0x+dYgeKBPy6RQN5ql2y34N/05DttinbwEQEZ1u7FOKzBD7lKZtB15IlUp6CRCat+tnz+c/8RfGmS+c="
  - secure: "wTy5E4DD83S5aRgaXjgiZvbstMJK736h2FVVRA/EW0jsc/BLwYagSWgh84B+MKub10/JEvlLizvCOY81JiV8uf9IKxGnxaj3Lal5cqxF3USzvyDsdJsxI7Ek87PcN/34LQyC/nzk7kEC00ibxllvEQRJHyNEOsnuM5gQTQPb6HftdMP6wMwBziqvMwhgOORN4S1nwwlO4a22A0ouV98dzIi627ehQs9+gRK99bzjD1n7GjGrh6Fkkb593MQxNBLjnTgy2Ots2Iootu1j6KtOF+adyNugyXL9Yfbmg0MXkWJzbaDc8ZAX8Hmv3FzjIKPUmLyLJU5JcxQ8Ivmu45MHGnOOhV/KSGdU/xcT15UoaoRAbUVUBGVljWR9cFVFZHbAVDuWFEyFAbW1gEaqPzfoTsJs1wjL5cnQ2MHhm8KqGqCCwV2RjK+4Yi73rNmh8zrSaFEEgrPzXqrvhwio1dG27AmyCoDWum7mQtDSvqyW+POhG88Y+5aIh49EMyar/4DndX6PFa+Ot0oIrwC50DOEzSOYSt5+KfOjl0yAC1p3KsKgpVPZs6VKHel97ZBYXVTLpbr56e/jBam9fHqeAHkdcqVQsmM9mXTbV7ixo0dazf6q7fIYYy6/beIfep73jy8k6Ra8SmSYwQJsvAKC8MUqlSkO0C5qFdMjDrK4DmM1AoE="
  - secure: "uawiw2n/e4piC64CShMbLk9nHOpb7J5FDBmH0pqVDb/aF6DqCV/ceo9ODKux58Qi5vRQFiKGmgneycWIT6SHlU4Jcs3EY5ex2mqMaIXUgHRHKqPbBnh5ORPUCfvyF3K/mGUi2pIcoIFKra/zKQv58+90nMg2Vs3d9yunP1Q44K8DZUzwUNR3e3sElFfLXw7KIR0DZX7/Ybw5v6v7+l3lmI72AFGFIkL3wp7GjdCOx0hVNO1ycE12WcXpzIAYLKqPpjSW6ty/ML8ahdFh49dGY9cCfeOdbevarTUS/zO0Jad8vbl8NMIyyb2m+wWOTrgXte87aLfGypPIVmbtbR4eS/9gH0bY8YiFcl9i9wBsXdAHridWQAnBRN5M4GcjtU0nSY5esnd8Lfu/x3WcyVwR+8GUsGby+dpbBUwxdhq/PaTK/ws4eoVQJmyNF0ifKBD3UkcqlD4SHZsn64XplMxrO2NlDPoDy1cpLfBntwpD926c2bJX9m0j8v29LnM/2WxyOF8NBKVgvOcQn4l1ema6STl8sy0W+o+WEWPtLQlFHKY86DzaG/vFUTSFhLtKB71vh6mhRsIBxvfnG+69+2FCfcu4ii2SZHb3dhWwZFBqwIdRSiCX8nU6xQ7WJbT57XXjCBRJQWUDmL+uy9YsIcB4OEdk+0j45Ang7d5NlawfD+s="
  