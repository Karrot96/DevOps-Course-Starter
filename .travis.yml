services:
- docker
before_install:
- echo $DOCKER_PASSWD | docker login -u karrot96 --password-stdin
- docker pull karrot96/todo-app
- docker build --tag karrot96/todo-app --cache-from karrot96/todo-app .
- docker push karrot96/todo-app
- docker build --target test --tag my-test-image --cache-from karrot96/todo-app .
script:
- docker run -e MONGO_URL -e APP_NAME my-test-image
after_success: 
- "./travis/build_and_tag_production.sh"
deploy:
  provider: script
  script: "./travis/deploy_to_heroku.sh"
  on:
    branch: master
env:
  global:
  - secure: "ka+vJ+gVf9wWFRXrsGw1dOYGF6xGi63gxjkQ/fLWonr0pDwpVVJEzKDUZ0Xeal07wbK5fnEptxusrKXNUyJpPVXzOHfR7YHbhGkKdaQ3sZ+wKfVSP+HV34hWDM6IGz/YOEewyj+zodJ13UGxENGkk1Bidp+bviYX+kQClSFoSzh+tf1JzalnP12TqlEFdocJZ3ilj4TvMkVaX7Sn65PtLjInaGMxyiyNIp9SSnSejDS1A8I5tIwwodztILvgfmy4K8eJY2UzTr6mnuhV+cKvVTH0jsnVhGRkH02gowBUlKIZ9Zn9B0U+OXcSmWS8VeIMGZ7sL+hOp1fOpQwTVDSIc9cnWsKO3kskinUEJnBez4zn0lY4OfQ7f/iZ3Lf8cyy4emPhxnNCkiuvBqagKFIS5q1saXEQIKuLIBc72iIYnKTHz66CqGoYZy0jRGuF8NR9Wa8Toz6+DtLWdb3sUUj6txZE38tJn05tnSu0LpZLgBmB3XNR1eRKdL0xCJqW1aV2VwpAw98gy4Req4y16NhUwVWSJw2LzsuSLEm8/08375mUmtheY2kj3YBXWFqJT5p4O7Fv7RRy/BAA+aeo4D7k/4zuViApud6Ny5uhBn6iqXaPBgIcIVP7LPAWA0MP9qyg1/NUQ6jNRk9kZ39Xa9ol9jRHMhzuJ1g9CSNw/BZGfuU="
  - secure: "wm3fzdS/qmcRc4ylLatJI6Hh3BMTxxo51zbvKyim5b/ao5L9W6BiR80z0vkMyqGf5LFxUJk+2p2Fp+t0ENGFVDevboaYKdzlNGTKXXP7GCuyswVhMYAJ+8zQ3uGI9yN+7iDCUVR2yfu10go0KXqFn2aU2FO2P/zt9VxiCA8R/jvQF/ma3iUr14o1X5RdezbgszYVXzKKY4dWcKgxD88wr8tqJzwp79KGytuMHTtz5vWkw5bvTuAoxpZCXSkwI3FNWFX5ctcz0OZHfYMR5xM9/YMvG7OF9Vqd1ejYhwbuiBofSwskzAifpArQw++RX09bEjxR5l8/8TMvLvePy4EbglqdwpE3+A1qxPo3Vmda8hFYauMDbObx+wyFDtt5qsoXDTUds90IaWbAqhBjcPlNc1vObiQIUQUAa3JAc1DujkEFgboRIwKeBqQPcK0XyPt3ocl4Kq7AinXIY6gZEhTnsumKCTFpQikes0PaFp2wgnDeRYAyHNmAnweHiPqKnc/+vMU+R0XOpilPs87ynoeCcjpmAC50foKxCGI2E8ZqGnT/ScdToVORVOTFZanF3Y+trWt65ppeb6B6FN7SmQat0hcI3kkH4asm65QCZbfko4AmtTIXzh2EJshIbXsi8F1IaMLOLDyZ5rrefBWkR4OD0GuN1wHlAMXUlZfxH7CPIqE="
  - secure: "s/K8iX1D0SfENhldwj9MNA55lkqEf+H725Duevei8JiZzmIdelJ3bvhMG66o4jOOHPmos1NkEp+IMInYqi6iedUsRFLHBoQ5dNzaV+AxBPgN14KUnMjs0C5IqbTbn2gfx+BaaSUZOzVTlgdnIluLlxDpZSB3bUlw/SgvkmaC8SqxwmDHgaoReJE43DTxCzZKvtxNvhfpceXwUtQmBPi9GviqBHWnAzdLLxRvOGeYloir5h6S7PE2ruh5Qj62tC/8AsFOtuw6YhNrHDqYMRynXHDxtny+ryGAzww7ZZGMoh0XqWqsP3GxgJKSYO7gJQN11SyBkpBGkTRYW0AdyVt3LvjBvpB2DCP6OrecS/hh9z4OVUrkqdOUtFJKGwMFn4wGayncu8TDrcdLKeMCjvPDGI2Hqgk7YHHka9DJmizD+Gr6QCGT8YcwuPJZZLcBgaASNde2h3u55L5Abgy0+nZfyIA5Gq6stdUNTaO4TAbTvZ1Qt6yhoiySZZCi4tuqIt5r6GXqEIqbM3hfV8KOgh29m84/xoQLCzUyK2fUIVAHwUc1Tlsle4JsvmjAonuUGIkBnZGZ4kACNXH37TvvJHbkQ7iQ2fauuWei9F63z7cjXQatuQ7uCvjCoPQe0x4G4KOFU8H7n0U2TpEFyuLvUYMD9mTucJA2a6J2cchC91B7KKw="
  - secure: "Ljxedw0vc57IUD9SicDrmUnJKQa6+mCqo4Ou94ATQlWOuSUAH4ljuuC9XVyHMrKycj/d0y4PVq1xkjz56fZTIqJBmaKWbXjKouYyHtafW3UzzvstCSfPkhbAmWaTBk+XhGmnWQToH56Z0WDZgQJV98rWPPcxjVPtd5sOsXfYV63vBYhU2KSNOTsZjxSbvVzM8aWEMjDPKwnVApy/Rb2mrpbcYBhZGOORK3aDbTJ9Dym89x6KlkukP+s8b+P7T6wp4HnN6c4RgP/T/a9pAyIXVbplXpuiruv73tgot32Cv3SMdRbV4TldM/z5QCWsckGBMFj8fwO0s0vE6InnuYbJeUeMjOlPxhtRnZcfM/LCl33l7NWMzRYD5vtBp8SJwwki9we34AhgnSx/q1Io806j/nZGbA5oeIQr02JtCYhTHU98E/ySWyXL2ii6iSdtHKcDHZ7VUp6PqnCSClz5J3jDUog0VI78PnGtaDCLqMv4kkMPreA6+FlCCqizdDbOa+jRuVKlKk1RHhMQMcl8PnG3MZ4PaX9pIQgqYAvg1khz7ufXI8eCMYRySufhEy28hzAIqqbzoRBnuRjsMYxxzFCOHB2GhjBNaHCBv1d7mB9Ngluy52T6Gv3EkvYEp0PyBklHR8FtXi+7VifP/YmI8enr+aUblJt69ZnMuHEoAES1SwE="
